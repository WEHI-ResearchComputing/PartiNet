"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[985],{8453:(e,r,t)=>{t.d(r,{R:()=>d,x:()=>c});var i=t(6540);const n={},s=i.createContext(n);function d(e){const r=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),i.createElement(s.Provider,{value:r},e.children)}},8644:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"stages/detect","title":"2. Detect","description":"PartiNet uses a modified version of an adaptive YOLO architecture called DynamicDet (Lin et al., 2023) to identify particles in cryo-EM micrographs. This stage provides highly accurate particle detection with customizable confidence and overlap thresholds.","source":"@site/docs/stages/detect.md","sourceDirName":"stages","slug":"/stages/detect","permalink":"/docs/stages/detect","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/stages/detect.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"1. Denoise","permalink":"/docs/stages/denoise"},"next":{"title":"3. STAR","permalink":"/docs/stages/star"}}');var n=t(4848),s=t(8453);const d={sidebar_position:2},c="2. Detect",o={},a=[{value:"Quick Start",id:"quick-start",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Required Parameters",id:"required-parameters",level:3},{value:"Customizable Parameters",id:"customizable-parameters",level:3},{value:"Parameter Configuration Guide",id:"parameter-configuration-guide",level:2},{value:"Confidence Threshold (<code>--conf-thres</code>)",id:"confidence-threshold---conf-thres",level:3},{value:"IoU Threshold (<code>--iou-thres</code>)",id:"iou-threshold---iou-thres",level:3},{value:"Model Weights",id:"model-weights",level:2},{value:"Pre-trained Weights",id:"pre-trained-weights",level:3},{value:"Custom Model Weights",id:"custom-model-weights",level:3},{value:"Input Requirements",id:"input-requirements",level:2},{value:"Supported Formats",id:"supported-formats",level:3},{value:"Directory Structure",id:"directory-structure",level:3},{value:"Output",id:"output",level:2},{value:"Directory Structure",id:"directory-structure-1",level:3},{value:"Log File Output",id:"log-file-output",level:3},{value:"Output File Formats",id:"output-file-formats",level:3},{value:"Detection Coordinates (<code>labels/*.txt</code>)",id:"detection-coordinates-labelstxt",level:4},{value:"What&#39;s Next",id:"whats-next",level:2},{value:"References",id:"references",level:2},{value:"See Also",id:"see-also",level:2}];function l(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"2-detect",children:"2. Detect"})}),"\n",(0,n.jsxs)(r.p,{children:["PartiNet uses a modified version of an adaptive YOLO architecture called ",(0,n.jsx)(r.em,{children:"DynamicDet"})," (Lin et al., 2023) to identify particles in cryo-EM micrographs. This stage provides highly accurate particle detection with customizable confidence and overlap thresholds."]}),"\n",(0,n.jsx)(r.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",metastring:'title="Local Installation"',children:"partinet detect \\\r\n    --weight /path/to/downloaded/model_weights.pt \\\r\n    --source /data/partinet_picking/denoised \\\r\n    --device 0,1,2,3 \\\r\n    --project /data/partinet_picking\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",metastring:'title="Apptainer/Singularity"',children:"apptainer exec --nv --no-home \\\r\n    -B /data oras://ghcr.io/wehi-researchcomputing/partinet:main-singularity partinet detect \\\r\n    --weight /path/to/downloaded/model_weights.pt \\\r\n    --source /data/partinet_picking/denoised \\\r\n    --device 0,1,2,3 \\\r\n    --project /data/partinet_picking\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",metastring:'title="Docker"',children:"docker run --gpus all -v /data:/data \\\r\n    ghcr.io/wehi-researchcomputing/partinet:main partinet detect \\\r\n    --weight /path/to/downloaded/model_weights.pt \\\r\n    --source /data/partinet_picking/denoised \\\r\n    --device 0,1,2,3 \\\r\n    --project /data/partinet_picking\n"})}),"\n",(0,n.jsx)(r.h2,{id:"parameters",children:"Parameters"}),"\n",(0,n.jsx)(r.h3,{id:"required-parameters",children:"Required Parameters"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Parameter"}),(0,n.jsx)(r.th,{children:"Description"}),(0,n.jsx)(r.th,{children:"Example"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"--weight"})}),(0,n.jsx)(r.td,{children:"Path to pre-trained model weights file"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/data/models/partinet_yolov7_weights.pt"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"--source"})}),(0,n.jsx)(r.td,{children:"Path to directory containing micrographs to process"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/data/partinet_picking/denoised"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"--project"})}),(0,n.jsx)(r.td,{children:"Path to project directory where outputs will be saved"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/data/partinet_picking"})})]})]})]}),"\n",(0,n.jsx)(r.h3,{id:"customizable-parameters",children:"Customizable Parameters"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Parameter"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"}),(0,n.jsx)(r.th,{children:"Default"}),(0,n.jsx)(r.th,{children:"Notes"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"--conf-thres"})}),(0,n.jsx)(r.td,{children:"float"}),(0,n.jsx)(r.td,{children:"Confidence threshold for detection (0.0-1.0)"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"0.1"})}),(0,n.jsx)(r.td,{children:"Lower = more detections, higher = fewer but more confident"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"--iou-thres"})}),(0,n.jsx)(r.td,{children:"float"}),(0,n.jsx)(r.td,{children:"IoU threshold for non-maximum suppression (0.0-1.0)"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"0.2"})}),(0,n.jsx)(r.td,{children:"Higher = more aggressive overlap removal"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"--device"})}),(0,n.jsx)(r.td,{children:"string"}),(0,n.jsx)(r.td,{children:"GPU devices to use (comma-separated)"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"0,1,2,3"})}),(0,n.jsxs)(r.td,{children:["Use ",(0,n.jsx)(r.code,{children:"0"})," for single GPU, ",(0,n.jsx)(r.code,{children:"0,1"})," for two GPUs, etc. Leave empty for CPU only"]})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"parameter-configuration-guide",children:"Parameter Configuration Guide"}),"\n",(0,n.jsxs)(r.h3,{id:"confidence-threshold---conf-thres",children:["Confidence Threshold (",(0,n.jsx)(r.code,{children:"--conf-thres"}),")"]}),"\n",(0,n.jsxs)(r.p,{children:["The confidence threshold determines the minimum confidence score required for a detection to be considered valid. Even with denoised micrographs, overall confidence will be low due to low SNR. It is not recommended to increase this above 0.5. We recommend setting this threshold quite low ",(0,n.jsx)(r.code,{children:"0.0-0.3"})," during this stage, and then filtering during STAR file generation."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Recommended starting values:"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"New datasets, small proteins, low defocus"}),": ",(0,n.jsx)(r.code,{children:"0.0-0.2"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Large proteins/complexes, higher defocus"}),": ",(0,n.jsx)(r.code,{children:"0.2-0.5"})]}),"\n"]}),"\n",(0,n.jsxs)(r.h3,{id:"iou-threshold---iou-thres",children:["IoU Threshold (",(0,n.jsx)(r.code,{children:"--iou-thres"}),")"]}),"\n",(0,n.jsx)(r.p,{children:"The Intersection over Union (IoU) threshold controls how aggressively overlapping detections are removed. The higher the value, the more that overlapping particles for removed"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Recommended starting value"}),": ",(0,n.jsx)(r.code,{children:"0.2"})]}),"\n",(0,n.jsx)(r.h2,{id:"model-weights",children:"Model Weights"}),"\n",(0,n.jsx)(r.h3,{id:"pre-trained-weights",children:"Pre-trained Weights"}),"\n",(0,n.jsxs)(r.p,{children:["PartiNet model weights are available on ",(0,n.jsx)(r.a,{href:"https://huggingface.co/MihinP/PartiNet",children:"HuggingFace"}),".\r\nWeights can be downloaded through the browser or through CLI via Git LFS"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",children:"# Verify Git LFS is installed\r\ngit lfs --help\r\nmkdir PartiNet_weights\r\ncd PartiNet_weights\r\ngit clone git@hf.co:MihinP/PartiNet\n"})}),"\n",(0,n.jsxs)(r.p,{children:["You will see two ",(0,n.jsx)(r.code,{children:".pt"})," files available: ",(0,n.jsx)(r.code,{children:"denoised_micrographs.pt"})," and ",(0,n.jsx)(r.code,{children:"raw_micrographs.pt"}),"."]}),"\n",(0,n.jsx)(r.h3,{id:"custom-model-weights",children:"Custom Model Weights"}),"\n",(0,n.jsxs)(r.p,{children:["If you have ",(0,n.jsx)(r.a,{href:"../../docs/category/training",children:"trained your own PartiNet model"})," you may use custom weights:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",children:"partinet detect \\\r\n    --backbone-detector yolov7-w6 \\\r\n    --weight /path/to/your/custom_weights.pt \\\r\n    --source /data/partinet_picking/denoised \\\r\n    --conf-thres 0.4 \\\r\n    --iou-thres 0.2 \\\r\n    --device 0,1 \\\r\n    --project /data/partinet_picking\n"})}),"\n",(0,n.jsx)(r.h2,{id:"input-requirements",children:"Input Requirements"}),"\n",(0,n.jsx)(r.h3,{id:"supported-formats",children:"Supported Formats"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"PNG files"})," (",(0,n.jsx)(r.code,{children:".png"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"JPEG files"})," (",(0,n.jsx)(r.code,{children:".jpg"}),", ",(0,n.jsx)(r.code,{children:".jpeg"}),")"]}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,n.jsx)(r.p,{children:"Your source directory should contain micrographs:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"denoised/\r\n\u251c\u2500\u2500 micrograph_001.png\r\n\u251c\u2500\u2500 micrograph_002.png\r\n\u251c\u2500\u2500 micrograph_003.png\r\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,n.jsx)(r.h2,{id:"output",children:"Output"}),"\n",(0,n.jsx)(r.h3,{id:"directory-structure-1",children:"Directory Structure"}),"\n",(0,n.jsx)(r.p,{children:"After detection, your project directory will contain:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"partinet_picking/\r\n\u251c\u2500\u2500 motion_corrected/          # \ud83d\udcc1 Your input micrographs\r\n\u2502   \u251c\u2500\u2500 micrograph1.mrc\r\n\u2502   \u251c\u2500\u2500 micrograph2.mrc\r\n\u2502   \u2514\u2500\u2500 ...\r\n\u251c\u2500\u2500 denoised/                  # \ud83e\uddf9 Created by denoise stage\r\n\u2502   \u251c\u2500\u2500 micrograph1.mrc\r\n\u2502   \u251c\u2500\u2500 micrograph2.mrc\r\n\u2502   \u2514\u2500\u2500 ...\r\n\u251c\u2500\u2500 exp/                       # \ud83c\udfaf Created by detect stage\r\n\u2502   \u251c\u2500\u2500 labels/               # \ud83d\udccb Detection coordinates\r\n\u2502   \u2502   \u251c\u2500\u2500 micrograph1.txt\r\n\u2502   \u2502   \u251c\u2500\u2500 micrograph2.txt\r\n\u2502   \u2502   \u2514\u2500\u2500 ...\r\n\u2502   \u251c\u2500\u2500 micrograph1.mrc       # \ud83d\uddbc\ufe0f Micrographs with detections drawn\r\n\u2502   \u251c\u2500\u2500 micrograph2.mrc\r\n\u2502   \u2514\u2500\u2500 ...\r\n\u2514\u2500\u2500 partinet_detect.log\n"})}),"\n",(0,n.jsx)(r.h3,{id:"log-file-output",children:"Log File Output"}),"\n",(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"partinet_detect.log"})," file provides detailed processing information:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-log",children:"2025-09-10 16:08:07 | INFO | Using devices: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3']\r\n2025-09-10 16:08:11 | INFO | Model loaded on cuda:0\r\n2025-09-10 16:08:15 | INFO | Model loaded on cuda:1\r\n2025-09-10 16:08:17 | INFO | Model loaded on cuda:2\r\n2025-09-10 16:08:20 | INFO | Model loaded on cuda:3\r\n2025-09-10 16:08:21 | INFO | [cuda:0] Processing 000000633063778279389_FoilHole_30903560_Data_30900510_30900512_20201031_010810_fractions_patch_aligned.png\r\n2025-09-10 16:08:21 | INFO | [cuda:1] Processing 000005251007454303721_FoilHole_30909875_Data_30900510_30900512_20201101_040227_fractions_patch_aligned.png\r\n2025-09-10 16:08:21 | INFO | [cuda:2] Processing 000012049843629116854_FoilHole_30902824_Data_30900510_30900512_20201030_230632_fractions_patch_aligned.png\r\n2025-09-10 16:08:22 | INFO | [cuda:3] Processing 000018235333323367981_FoilHole_30905009_Data_30900510_30900512_20201031_082713_fractions_patch_aligned.png\r\n2025-09-10 16:08:24 | INFO | [cuda:1] 000005251007454303721_FoilHole_30909875_Data_30900510_30900512_20201101_040227_fractions_patch_aligned.png: 94 particles, 3516.2 ms\r\n2025-09-10 16:08:24 | INFO | [cuda:1] Processing 000022392129605454366_FoilHole_30903097_Data_30900534_30900536_20201031_002940_fractions_patch_aligned.png\r\n2025-09-10 16:08:25 | INFO | [cuda:2] 000012049843629116854_FoilHole_30902824_Data_30900510_30900512_20201030_230632_fractions_patch_aligned.png: 272 particles, 3604.4 ms\n"})}),"\n",(0,n.jsx)(r.h3,{id:"output-file-formats",children:"Output File Formats"}),"\n",(0,n.jsxs)(r.h4,{id:"detection-coordinates-labelstxt",children:["Detection Coordinates (",(0,n.jsx)(r.code,{children:"labels/*.txt"}),")"]}),"\n",(0,n.jsx)(r.p,{children:"Each txt file corresponds to a single micrograph. Each line represents one detection in YOLO format:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"class_id x_center y_center width height confidence\r\n0 0.5234 0.3456 0.0234 0.0198 0.8567\n"})}),"\n",(0,n.jsx)(r.p,{children:"Where coordinates are normalized (0.0-1.0) relative to micrograph dimensions."}),"\n",(0,n.jsx)(r.h2,{id:"whats-next",children:"What's Next"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"/docs/stages/star",children:"STAR"})}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["Congratulations! You have picked particles from your micrographs, you can now move to the final stage with ",(0,n.jsx)(r.a,{href:"/docs/stages/star",children:"STAR"}),"."]}),"\n",(0,n.jsx)(r.h2,{id:"references",children:"References"}),"\n",(0,n.jsxs)(r.p,{children:["Lin, Z., Wang, Y., Zhang, J., & Chu, X. (2023). DynamicDet: A Unified Dynamic Architecture for Object Detection (arXiv:2304.05552). arXiv. ",(0,n.jsx)(r.a,{href:"https://doi.org/10.48550/arXiv.2304.05552",children:"https://doi.org/10.48550/arXiv.2304.05552"})]}),"\n",(0,n.jsx)(r.h2,{id:"see-also",children:"See Also"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"/docs/stages/denoise",children:"Denoise"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"/docs/stages/star",children:"STAR"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);