"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[802],{6021:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"stages/denoise","title":"1. Denoise","description":"Denoising can vastly improve particle picking by helping to increase signal to noise in low-dose micrographs. Different denoising algorithms exist, include deep denoisers Topaz (Bepler et al., 2020) and Janni (Wagner and Raunser., 2020) and various Gaussian and fourier space denoisers. PartiNet implements a modified heuristic Wiener filter denoiser based on the method from CryoSegNet (Gyawali et al., 2024). PartiNet\'s implementation introduces multiprocessing, allowing for high-throughput denoising of large datasets, as well as saving in .mrc format if you prefer to perform picking on denoised micrographs in RELION or CryoSPARC.","source":"@site/docs/stages/denoise.md","sourceDirName":"stages","slug":"/stages/denoise","permalink":"/docs/stages/denoise","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/stages/denoise.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Picking","permalink":"/docs/category/picking"},"next":{"title":"2. Detect","permalink":"/docs/stages/detect"}}');var t=i(4848),s=i(8453);const o={sidebar_position:1},c="1. Denoise",a={},d=[{value:"Parameters",id:"parameters",level:2},{value:"Required Parameters",id:"required-parameters",level:3},{value:"Optional Parameters",id:"optional-parameters",level:3},{value:"Input Requirements",id:"input-requirements",level:2},{value:"Motion-Corrected Micrographs",id:"motion-corrected-micrographs",level:3},{value:"Quality Control Check",id:"quality-control-check",level:3},{value:"Directory Structure",id:"directory-structure",level:3},{value:"Setup Instructions",id:"setup-instructions",level:2},{value:"1. Create Project Directory",id:"1-create-project-directory",level:3},{value:"2. Transfer Motion-Corrected Micrographs",id:"2-transfer-motion-corrected-micrographs",level:3},{value:"3. Run Denoising",id:"3-run-denoising",level:3},{value:"Output",id:"output",level:2},{value:"Directory Structure",id:"directory-structure-1",level:3},{value:"Log File Output",id:"log-file-output",level:3},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Custom CPU Configuration",id:"custom-cpu-configuration",level:3},{value:"Different Output Formats",id:"different-output-formats",level:3},{value:"What&#39;s Next",id:"whats-next",level:2},{value:"References",id:"references",level:2}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"1-denoise",children:"1. Denoise"})}),"\n",(0,t.jsx)(r.p,{children:"Denoising can vastly improve particle picking by helping to increase signal to noise in low-dose micrographs. Different denoising algorithms exist, include deep denoisers Topaz (Bepler et al., 2020) and Janni (Wagner and Raunser., 2020) and various Gaussian and fourier space denoisers. PartiNet implements a modified heuristic Wiener filter denoiser based on the method from CryoSegNet (Gyawali et al., 2024). PartiNet's implementation introduces multiprocessing, allowing for high-throughput denoising of large datasets, as well as saving in .mrc format if you prefer to perform picking on denoised micrographs in RELION or CryoSPARC."}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"denoise workflow",src:i(8109).A+"",width:"2560",height:"1900"})}),"\n",(0,t.jsx)(r.h2,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsx)(r.h3,{id:"required-parameters",children:"Required Parameters"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Description"}),(0,t.jsx)(r.th,{children:"Example"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"--source"})}),(0,t.jsx)(r.td,{children:"Directory containing motion-corrected micrographs in MRC format"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"/data/partinet_picking/motion_corrected"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"--project"})}),(0,t.jsx)(r.td,{children:"Parent project directory where all outputs will be saved"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"/data/partinet_picking"})})]})]})]}),"\n",(0,t.jsx)(r.h3,{id:"optional-parameters",children:"Optional Parameters"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{children:"Default"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"--num_workers"})}),(0,t.jsx)(r.td,{children:"int"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"max available CPUs"})}),(0,t.jsx)(r.td,{children:"Number of CPU workers for processing"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"--img_format"})}),(0,t.jsx)(r.td,{children:"string"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"png"})}),(0,t.jsxs)(r.td,{children:["Output format for denoised images (",(0,t.jsx)(r.code,{children:"png"}),", ",(0,t.jsx)(r.code,{children:"jpg"}),", ",(0,t.jsx)(r.code,{children:"mrc"}),")"]})]})]})]}),"\n",(0,t.jsx)(r.h2,{id:"input-requirements",children:"Input Requirements"}),"\n",(0,t.jsx)(r.h3,{id:"motion-corrected-micrographs",children:"Motion-Corrected Micrographs"}),"\n",(0,t.jsx)(r.p,{children:"Your motion-corrected micrographs should ideally meet these criteria in order for the denoising to work correctly:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Format"}),": single-slice MRC files from RELION or CryoSPARC"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Motion correction"}),": Total full frame motion should be ",(0,t.jsx)(r.strong,{children:"less than 100 pixels"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CTF estimation"}),": CTF fit resolution should be ",(0,t.jsx)(r.strong,{children:"less than 10 Angstroms"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Convergence"}),": Motion correction and CTF estimation should have converged appropriately"]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"quality-control-check",children:"Quality Control Check"}),"\n",(0,t.jsxs)(r.p,{children:["In CryoSPARC, you can verify micrograph quality using the ",(0,t.jsx)(r.strong,{children:"Manually Curate Exposures"})," job:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Navigate to: Processing \u2192 Exposure Curation \u2192 Interactive Job: Manually Curate Exposures"}),"\n",(0,t.jsx)(r.li,{children:"Check motion and CTF fit parameters for each micrograph"}),"\n",(0,t.jsx)(r.li,{children:"Remove micrographs that don't meet quality criteria"}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,t.jsx)(r.p,{children:"Your motion-corrected directory should contain:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"motion_corrected/\r\n\u251c\u2500\u2500 micrograph_001_fractions_patch_aligned.mrc\r\n\u251c\u2500\u2500 micrograph_002_fractions_patch_aligned.mrc\r\n\u251c\u2500\u2500 micrograph_003_fractions_patch_aligned.mrc\r\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,t.jsx)(r.h2,{id:"setup-instructions",children:"Setup Instructions"}),"\n",(0,t.jsx)(r.h3,{id:"1-create-project-directory",children:"1. Create Project Directory"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:"mkdir partinet_picking\r\ncd partinet_picking\r\nmkdir motion_corrected\n"})}),"\n",(0,t.jsx)(r.h3,{id:"2-transfer-motion-corrected-micrographs",children:"2. Transfer Motion-Corrected Micrographs"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"From CryoSPARC:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:"# Using symbolic links (faster, saves space)\r\nln -s /path/to/cryosparc/project/job_number/motioncorrected/*_fractions_patch_aligned.mrc motion_corrected/\r\n\r\n# Using rsync (copies files)\r\nrsync /path/to/cryosparc/project/job_number/motioncorrected/*_fractions_patch_aligned.mrc motion_corrected/\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"From RELION:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:"# Link motion-corrected micrographs\r\nln -s /path/to/relion/project/MotionCorr/job_number/Micrographs/*.mrc motion_corrected/\n"})}),"\n",(0,t.jsx)(r.h3,{id:"3-run-denoising",children:"3. Run Denoising"}),"\n",(0,t.jsxs)("div",{class:"container-tabs",children:[(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",metastring:'title="Apptainer/Singularity"',children:"apptainer exec --nv --no-home \\\r\n    -B /data oras://ghcr.io/wehi-researchcomputing/partinet:main-singularity partinet denoise \\\r\n    --source /data/partinet_picking/motion_corrected \\\r\n    --project /data/partinet_picking\n"})}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",metastring:'title="Docker"',children:"docker run --gpus all -v /data:/data \\\r\n    ghcr.io/wehi-researchcomputing/partinet:main partinet denoise \\\r\n    --source /data/partinet_picking/motion_corrected \\\r\n    --project /data/partinet_picking\n"})}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",metastring:'title="Local Installation"',children:"partinet denoise \\\r\n    --source /data/partinet_picking/motion_corrected \\\r\n    --project /data/partinet_picking\n"})}),(0,t.jsx)(r.h2,{id:"output",children:"Output"}),(0,t.jsx)(r.h3,{id:"directory-structure-1",children:"Directory Structure"}),(0,t.jsx)(r.p,{children:"After denoising, your project directory will contain:"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"partinet_picking/\r\n\u251c\u2500\u2500 motion_corrected/\r\n\u2502   \u2514\u2500\u2500 [original MRC files]\r\n\u251c\u2500\u2500 denoised/\r\n\u2502   \u251c\u2500\u2500 micrograph_001_fractions_patch_aligned.png\r\n\u2502   \u251c\u2500\u2500 micrograph_002_fractions_patch_aligned.png\r\n\u2502   \u251c\u2500\u2500 micrograph_003_fractions_patch_aligned.png\r\n\u2502   \u2514\u2500\u2500 ...\r\n\u2514\u2500\u2500 partinet_denoise.log\n"})}),(0,t.jsx)(r.h3,{id:"log-file-output",children:"Log File Output"}),(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"partinet_denoise.log"})," file provides detailed processing information:"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-log",children:"2025-07-15 17:37:03,807 - Using 48 workers out of 96 available CPUs.\r\n2025-07-15 17:37:03,807 - Processing raw micrographs in /data/partinet_picking/motion_corrected\r\n2025-07-15 17:37:03,807 - Saving denoised micrographs in /data/partinet_picking/denoised\r\n2025-07-15 17:37:03,812 - Directory ready: /data/partinet_picking/denoised\r\n2025-07-15 17:37:49,774 - Processed image micrograph_001_fractions_patch_aligned.mrc to dest. micrograph_001_fractions_patch_aligned.png\r\n2025-07-15 17:37:49,956 - Processed image micrograph_002_fractions_patch_aligned.mrc to dest. micrograph_002_fractions_patch_aligned.png\n"})}),(0,t.jsxs)(r.p,{children:["Congratulations! You have prepared your micrographs for picking, you can now move to particle picking with ",(0,t.jsx)(r.a,{href:"/docs/stages/detect",children:"Detect"}),"."]}),(0,t.jsx)(r.h2,{id:"advanced-usage",children:"Advanced Usage"}),(0,t.jsx)(r.h3,{id:"custom-cpu-configuration",children:"Custom CPU Configuration"}),(0,t.jsxs)(r.p,{children:["Number of CPUs used by PartiNet is controlled with ",(0,t.jsx)(r.code,{children:"--num_workers"}),". These CPUs are automatically split between tasks to optimize for CPU utilization during denoising:"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Processing CPUs"}),": Half of available CPUs used for denoising"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"I/O CPUs"}),": Remaining CPUs reserved for file operations"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Resource efficiency"}),": Achieves close to 100% CPU utilization"]}),"\n"]}),(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Example with 64 CPUs:"})}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:"--num_workers 64\n"})}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"32 CPUs for denoising operations"}),"\n",(0,t.jsx)(r.li,{children:"32 CPUs for I/O operations (reading/writing micrographs)"}),"\n"]}),(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Example in project:"})}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:"partinet denoise \\\r\n    --source /data/partinet_picking/motion_corrected \\\r\n    --project /data/partinet_picking \\\r\n    --num_workers 32\n"})}),(0,t.jsx)(r.h3,{id:"different-output-formats",children:"Different Output Formats"}),(0,t.jsxs)(r.p,{children:["By default PartiNet outputs denoised images in ",(0,t.jsx)(r.code,{children:"png"})," format. This is necessary for compatibility with the detection architecture. ",(0,t.jsx)(r.code,{children:"png"})," is a lossless compression, however micrographs are normalised from 32 bit depth ",(0,t.jsx)(r.code,{children:"mrc"})," files to 8 bit ",(0,t.jsx)(r.code,{children:"png"}),". ",(0,t.jsx)(r.code,{children:"jpg"})," is also available (eg for making figures) but is not recommended for use due to lossy compression."]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:"# JPEG format (smaller file size, lossy compression)\r\npartinet denoise \\\r\n    --source /data/partinet_picking/motion_corrected \\\r\n    --project /data/partinet_picking \\\r\n    --img_format jpg\r\n\r\n# PNG format (default, best for PartiNet pipeline, lossless compression)\r\npartinet denoise \\\r\n    --source /data/partinet_picking/motion_corrected \\\r\n    --project /data/partinet_picking \\\r\n    --img_format png\n"})}),(0,t.jsxs)(r.p,{children:["For use with other particle pickers (RELION, CryoSPARC, Topaz, crYOLO) ",(0,t.jsx)(r.code,{children:"mrc"})," is also available:"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:"partinet denoise \\\r\n    --source /data/partinet_picking/motion_corrected \\\r\n    --project /data/partinet_picking \\\r\n    --img_format mrc\n"})}),(0,t.jsx)(r.h2,{id:"whats-next",children:"What's Next"}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"/docs/stages/detect",children:"Detect"})}),"\n"]}),(0,t.jsx)(r.h2,{id:"references",children:"References"}),(0,t.jsxs)(r.p,{children:["Bepler, T., Kelley, K., Noble, A. J., & Berger, B. (2020). Topaz-Denoise: General deep denoising models for cryoEM and cryoET. Nature Communications, 11(1), 5208. ",(0,t.jsx)(r.a,{href:"https://doi.org/10.1038/s41467-020-18952-1",children:"https://doi.org/10.1038/s41467-020-18952-1"})]}),(0,t.jsxs)(r.p,{children:["Wagner, T., & Raunser, S. (2020). The evolution of SPHIRE-crYOLO particle picking and its application in automated cryo-EM processing workflows. Communications Biology, 3(1), 61. ",(0,t.jsx)(r.a,{href:"https://doi.org/10.1038/s42003-020-0790-y",children:"https://doi.org/10.1038/s42003-020-0790-y"})]}),(0,t.jsxs)(r.p,{children:["Gyawali, R., Dhakal, A., Wang, L., & Cheng, J. (2024). CryoSegNet: Accurate cryo-EM protein particle picking by integrating the foundational AI image segmentation model and attention-gated U-Net. Briefings in Bioinformatics, 25(4), bbae282. ",(0,t.jsx)(r.a,{href:"https://doi.org/10.1093/bib/bbae282",children:"https://doi.org/10.1093/bib/bbae282"})]})]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8109:(e,r,i)=>{i.d(r,{A:()=>n});const n=i.p+"assets/images/denoise_workflow_stacked-8ed4572c9bc2986ff2bc698d46b4c734.png"},8453:(e,r,i)=>{i.d(r,{R:()=>o,x:()=>c});var n=i(6540);const t={},s=n.createContext(t);function o(e){const r=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);